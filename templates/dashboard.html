<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Last Dance - ê°ì • ê¸°ë°˜ ìŒì•… ì¶”ì²œ</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='dashboard.css') }}" />
</head>
<body>
<header class="header">
  <div class="container">
    <div class="header-content">
      <div class="logo-section">
        <div class="logo">Last Dance</div>
        <div class="logo-subtitle">ê°ì • ê¸°ë°˜ ìŒì•… ì¶”ì²œ</div>
      </div>
      <div class="header-buttons">
        <a href="{{ url_for('profile.profile') }}" class="btn btn-primary">í”„ë¡œí•„</a>
        <a href="{{ url_for('public.logout') }}" class="btn btn-red">ë¡œê·¸ì•„ì›ƒ</a>
      </div>
    </div>
  </div>
</header>

<main class="main">
  <div class="container">
    <!-- Welcome -->
    <div class="welcome-section">
      <h1 class="welcome-title">ì•ˆë…•í•˜ì„¸ìš”! ğŸ‘‹</h1>
      <p class="welcome-text">ì˜¤ëŠ˜ í•˜ë£¨ëŠ” ì–´ë– ì…¨ë‚˜ìš”? ì¼ê¸°ë¥¼ ì‘ì„±í•˜ê³  ë§ì¶¤ ìŒì•…ì„ ë“¤ì–´ë³´ì„¸ìš”.</p>
      <div class="user-info">
        <p class="user-email">
          <strong>ì´ë©”ì¼:</strong>
          <span class="email-value" id="userEmail">{{ session['user']['email'] if session.get('user') and session['user'].get('email') else 'ë¡œê·¸ì¸ í•„ìš”' }}</span>
        </p>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
      <button onclick="writeDiary()" class="action-card">
        <div class="action-content">
          <div class="action-icon">âœï¸</div>
          <div class="action-text"><h3>ìƒˆ ì¼ê¸° ì‘ì„±</h3><p>ì˜¤ëŠ˜ì˜ ê°ì •ì„ ê¸°ë¡í•´ë³´ì„¸ìš”</p></div>
        </div>
      </button>
      <button onclick="showRecommendedMusic()" class="action-card blue">
        <div class="action-content">
          <div class="action-icon">ğŸµ</div>
          <div class="action-text"><h3>ì¶”ì²œ ìŒì•…</h3><p>ê°ì •ì— ë§ëŠ” ìŒì•… ë“£ê¸°</p></div>
        </div>
      </button>
      <button onclick="showEmotionCalendar()" class="action-card green">
        <div class="action-content">
          <div class="action-icon">ğŸ“…</div>
          <div class="action-text"><h3>ê°ì • ìº˜ë¦°ë”</h3><p>ê°ì • ë³€í™” ì¶”ì´ ë³´ê¸°</p></div>
        </div>
      </button>
    </div>

    <!-- Main Grid -->
    <div class="main-grid">
      <!-- Left Column -->
      <div class="left-column">
        <!-- ìµœê·¼ ì¼ê¸° (ë”ë¯¸ ì œê±°) -->
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">ğŸ“– ìµœê·¼ ì¼ê¸°</h2>
            <a href="#" class="card-link">ëª¨ë‘ ë³´ê¸°</a>
          </div>
          <div class="diary-list">
            <div class="empty-state">
              <div class="empty-icon">ğŸ“</div>
              <p>ì‘ì„±í•œ ì¼ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
              <a href="#" onclick="writeDiary()" class="empty-link">ìƒˆ ì¼ê¸° ì‘ì„±í•˜ê¸°</a>
            </div>
          </div>
        </div>
        <!-- ê°ì • ì¶”ì´ -->
        <div class="card">
          <h2 class="card-title">ğŸ“ˆ ì´ë²ˆ ì£¼ ê°ì • ì¶”ì´</h2>
          <div class="weekly-chart">
            <div class="chart-day"><div class="chart-bar" style="height: 0px;"></div><span class="chart-emoji">â“</span><span class="chart-label">ì›”</span></div>
            <div class="chart-day"><div class="chart-bar" style="height: 0px;"></div><span class="chart-emoji">â“</span><span class="chart-label">í™”</span></div>
            <div class="chart-day"><div class="chart-bar" style="height: 0px;"></div><span class="chart-emoji">â“</span><span class="chart-label">ìˆ˜</span></div>
            <div class="chart-day"><div class="chart-bar" style="height: 0px;"></div><span class="chart-emoji">â“</span><span class="chart-label">ëª©</span></div>
            <div class="chart-day"><div class="chart-bar" style="height: 0px;"></div><span class="chart-emoji">â“</span><span class="chart-label">ê¸ˆ</span></div>
            <div class="chart-day"><div class="chart-bar" style="height: 0px;"></div><span class="chart-emoji">â“</span><span class="chart-label">í† </span></div>
            <div class="chart-day"><div class="chart-bar" style="height: 0px;"></div><span class="chart-emoji">â“</span><span class="chart-label">ì¼</span></div>
          </div>
        </div>
      </div>

      <!-- Right Column -->
      <div class="right-column">
        <!-- ì˜¤ëŠ˜ì˜ ê°ì • -->
        <div class="card">
          <h2 class="card-title">â¤ï¸ ì˜¤ëŠ˜ì˜ ê°ì •</h2>
          <div class="emotion-display">
            <div class="emotion-large">ğŸ˜</div>
            <div class="emotion-tag emotion-neutral">ì¤‘ë¦½</div>
          </div>
        </div>

        <!-- ìŠ¤í¬í‹°íŒŒì´ ì¶”ì²œ ìŒì•… -->
        <div class="card">
          <h2 class="card-title">ğŸµ ì¶”ì²œ ìŒì•…</h2>
          <div class="music-player" id="currentlyPlaying">
            <div class="song-info">
              <div class="song-title" id="currentSongTitle">ì¬ìƒ ì¤‘ì¸ ìŒì•… ì—†ìŒ</div>
              <div class="song-artist" id="currentSongArtist">-</div>
            </div>
            <div class="player-controls">
              <button onclick="togglePlay()" class="control-btn"><span id="playIcon">â–¶ï¸</span></button>
            </div>
          </div>
          <div class="music-list" id="musicList">
            <p>ìŒì•…ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>
          </div>
        </div>

        <!-- ì´ë²ˆ ë‹¬ í†µê³„ -->
        <div class="card">
          <h2 class="card-title">ğŸ“Š ì´ë²ˆ ë‹¬ í†µê³„</h2>
          <div class="stats-list">
            <div class="stat-item"><span class="stat-label">ì‘ì„±í•œ ì¼ê¸°</span><span class="stat-value">0ê°œ</span></div>
            <div class="stat-item"><span class="stat-label">í‰ê·  ê°ì • ì ìˆ˜</span><span class="stat-value">-</span></div>
            <div class="stat-item"><span class="stat-label">ë“¤ì€ ìŒì•…</span><span class="stat-value">0ê³¡</span></div>
            <div class="stat-item"><span class="stat-label">ê°€ì¥ ë§ì€ ê°ì •</span><span class="stat-value">ğŸ˜ ì¤‘ë¦½</span></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>

<!-- ìŠ¤í¬ë¦½íŠ¸ -->
<script>
  let currentAudio = new Audio();
  let isPlaying = false;

  async function loadSpotifyRecommendations(emotion = 'neutral') {
    const list = document.getElementById('musicList');
    list.innerHTML = '<p>ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>';
    try {
      const res = await fetch(`/api/spotify/recommend?emotion=${emotion}`);
      const tracks = await res.json();
      if (!tracks.length) {
        list.innerHTML = '<p>ì¶”ì²œ ìŒì•…ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
        return;
      }
      list.innerHTML = '';
      tracks.forEach(track => {
        const item = document.createElement('div');
        item.className = 'music-item';
        item.innerHTML = `
          <div class="music-info">
            <h4>${track.title}</h4>
            <div class="artist">${track.artist}</div>
            <div class="reason">${track.reason || 'ìŠ¤í¬í‹°íŒŒì´ ì¶”ì²œ'}</div>
          </div>
          <span class="play-icon">â–¶ï¸</span>
        `;
        item.onclick = () => playMusic(track.title, track.artist, track.url);
        list.appendChild(item);
      });
    } catch (e) {
      list.innerHTML = '<p>ìŒì•…ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>';
      console.error(e);
    }
  }

  function playMusic(title, artist, url) {
    if (!url) return alert('í•´ë‹¹ ê³¡ì€ ë¯¸ë¦¬ë“£ê¸° URLì´ ì—†ìŠµë‹ˆë‹¤.');
    currentAudio.src = url;
    currentAudio.play();
    isPlaying = true;
    document.getElementById('currentSongTitle').textContent = title;
    document.getElementById('currentSongArtist').textContent = artist;
    updatePlayIcon();
  }

  function togglePlay() {
    if (!currentAudio.src) return;
    isPlaying = !isPlaying;
    isPlaying ? currentAudio.play() : currentAudio.pause();
    updatePlayIcon();
  }

  function updatePlayIcon() {
    document.getElementById('playIcon').textContent = isPlaying ? 'â¸ï¸' : 'â–¶ï¸';
  }

  function writeDiary() {
    alert('ì¼ê¸° ì‘ì„± í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤. (ê°œë°œ ì¤‘)');
  }

  function showRecommendedMusic() {
    alert('ì¶”ì²œ ìŒì•… í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤. (ê°œë°œ ì¤‘)');
  }

  function showEmotionCalendar() {
    alert('ê°ì • ìº˜ë¦°ë” í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤. (ê°œë°œ ì¤‘)');
  }

  document.addEventListener('DOMContentLoaded', () => {
    loadSpotifyRecommendations('neutral');
  });
</script>
</body>
</html>
